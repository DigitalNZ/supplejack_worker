language: ruby
rvm:
  - 2.7.2

services:
  - mongodb

before_script:
  - cp config/application.yml.example config/application.yml

cache: bundler

bundler_args: --without production

sudo: false

notifications:
  slack:
    secure: UOHy+SR2jB+RCUygw7tSzeV51iLKPQeaKArdrVJvffw+rc5bN5TTmqQyCrPdGSSZiXIQ8DiW8kyLmWQ3AqQaVBpc05ADLnG9v6A6eSWeY8PKdrVyVe8rN5P2/50bKPpHAfdpmaMCwVNrbwcPIFWIDDGBNum4UsV3C3wd1wWuMME=

jobs:
  include:

    - stage: test
      name: 'Rubocop'
      script:
        - bundle exec rubocop

    - stage: test
      name: 'Rspec'
      script:
        - bundle exec rspec

    - stage: test
      name: 'bundle audit'
      script:
        - gem install bundler-audit
        - bundle audit update
        - bundle audit check

    - stage: test
      name: 'brakeman check'
      script:
        - gem install brakeman
        - brakeman --run-all-checks
